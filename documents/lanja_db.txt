DROP DATABASE IF EXISTS lanja_db;
CREATE DATABASE lanja_db;
USE lanja_db;

CREATE TABLE CalendarEvent (
event_id		INT              	NOT NULL  						AUTO_INCREMENT,
event_title		VARCHAR(50)         NOT NULL, 
event_desc		TEXT		        NOT NULL, 
event_location	VARCHAR(250)		NOT NULL, 
event_date		DATETIME			NOT NULL, 
recurring		ENUM('Daily', 'Weekly', 'Monthly', 'Annually')		NOT NULL, 
iterations		INT					NOT NULL, 
created_at		TIMESTAMP			NOT NULL, 
updated_at		TIMESTAMP,
deleted_at		TIMESTAMP,
PRIMARY KEY (event_id)
);

CREATE TABLE User (
user_id			INT					NOT NULL  						AUTO_INCREMENT,
first_name		VARCHAR(25)			NOT NULL, 
last_name		VARCHAR(25)			NOT NULL, 
user_email		VARCHAR(50)			NOT NULL, 
user_phone		VARCHAR(15)			NOT NULL, 
user_address	VARCHAR(200)			NOT NULL, 
password_hash	VARCHAR(50)			NOT NULL, 
is_active		BOOLEAN				NOT NULL, 
joined_on		TIMESTAMP			NOT NULL, 
last_login		TIMESTAMP			NOT NULL, 
PRIMARY KEY (user_id), 
UNIQUE INDEX user_email (user_email)
);

CREATE TABLE Attendance (
attendance_id	INT					NOT NULL  						AUTO_INCREMENT,
user_id 		INT					NOT NULL, 
event_id		INT					NOT NULL, 
attend_status	ENUM('Present', 'Absent', 'Late', 'Excused')		NOT NULL, 
check_in_time	DATETIME			NOT NULL, 
taken_by		INT					NOT NULL, 
taken_at		VARCHAR(100)			NOT NULL, 
notes			TEXT				NOT NULL, 
PRIMARY KEY (attendance_id), 
INDEX user_id (user_id), 
INDEX event_id (event_id), 
FOREIGN KEY (user_id) REFERENCES User (user_id),
FOREIGN KEY (taken_by) REFERENCES User (user_id),
FOREIGN KEY (event_id) REFERENCES CalendarEvent (event_id)
);

CREATE TABLE FormTemplate (
template_id		INT			 		NOT NULL  						AUTO_INCREMENT,
temp_title		VARCHAR(50)			NOT NULL, 
temp_desc		TEXT				NOT NULL, 
temp_status		ENUM('Draft', 'Active', 'Archived')					NOT NULL, 
form_questions	JSON				NOT NULL, 
form_deadline	DATETIME			NOT NULL, 
updated_at		TIMESTAMP,
deleted_at		TIMESTAMP,
PRIMARY KEY (template_id)
);

CREATE TABLE FormResponse (
response_id 	INT					NOT NULL  						AUTO_INCREMENT,
template_id		INT					NOT NULL, 
user_id			INT					NOT NULL, 
form_response	JSON				NOT NULL, 
form_status		ENUM('Pending', 'Reviewed', 'Finalized')			NOT NULL, 
PRIMARY KEY (response_id), 
INDEX template_id (template_id), 
INDEX user_id (user_id), 
FOREIGN KEY (template_id) REFERENCES FormTemplate (template_id),
FOREIGN KEY (user_id) REFERENCES User (user_id)
);

CREATE TABLE PasswordResetToken (
reset_id 		INT					NOT NULL  						AUTO_INCREMENT,
user_id			INT					NOT NULL, 
token			VARCHAR(15)			NOT NULL, 
reset_success	BOOLEAN				NOT NULL,
expires_at		TIMESTAMP			NOT NULL, 
used_at		TIMESTAMP,
PRIMARY KEY (reset_id),
INDEX user_id (user_id), 	
FOREIGN KEY (user_id) REFERENCES User (user_id)
);

CREATE TABLE Permission (
permission_id 	INT					NOT NULL  						AUTO_INCREMENT,
perm_title		VARCHAR(50)			NOT NULL, 
perm_desc		TEXT				NOT NULL, 
perm_resource	VARCHAR(100)		NOT NULL, 
perm_crud		ENUM('Create', 'Read', 'Update', 'Delete')	NOT NULL, 
PRIMARY KEY (permission_id)
);

CREATE TABLE Role (
role_id			INT					NOT NULL  						AUTO_INCREMENT,
role_name		VARCHAR(50)			NOT NULL, 
role_desc		TEXT				NOT NULL, 
PRIMARY KEY (role_id)	
);

CREATE TABLE RolePermission (
roleperm_id		INT					NOT NULL  						AUTO_INCREMENT,
permission_id	INT					NOT NULL, 
role_id			INT					NOT NULL, 
PRIMARY KEY (roleperm_id),
INDEX permission_id (permission_id),
INDEX role_id (role_id),
FOREIGN KEY (permission_id) REFERENCES Permission (permission_id),
FOREIGN KEY (role_id) REFERENCES Role (role_id)
);

CREATE TABLE UserRole (
user_id			INT					NOT NULL, 
role_id			INT					NOT NULL, 
PRIMARY KEY (user_id, role_id),
INDEX user_id (user_id),
INDEX role_id (role_id),
FOREIGN KEY (user_id) REFERENCES User (user_id),
FOREIGN KEY (role_id) REFERENCES Role (role_id)
);

CREATE TABLE Department (
dept_id			INT					NOT NULL  						AUTO_INCREMENT,
user_id			INT					NOT NULL, 
dept_name		VARCHAR(50)			NOT NULL, 
dept_desc		TEXT				NOT NULL, 
PRIMARY KEY (dept_id),
INDEX user_id (user_id),
FOREIGN KEY (user_id) REFERENCES User (user_id)
);

CREATE TABLE Document (
document_id		INT					NOT NULL  						AUTO_INCREMENT,
uploaded_by		INT					NOT NULL, 
visibility_scope	ENUM('Members', 'Dept Heads', 'Everyone')		NOT NULL, 
dept_id			INT,
doc_title		VARCHAR(50)			NOT NULL, 
stored_url		VARCHAR(250)		NOT NULL, 
archived		BOOLEAN				NOT NULL, 
created_at		TIMESTAMP			NOT NULL, 
updated_at		TIMESTAMP,
deleted_at		TIMESTAMP,
PRIMARY KEY (document_id),
INDEX dept_id (dept_id),
INDEX user_id (uploaded_by),
FOREIGN KEY (uploaded_by) REFERENCES User (user_id),
FOREIGN KEY (dept_id) REFERENCES Department (dept_id)
);

CREATE TABLE Announcement (
announcement_id		INT				NOT NULL  						AUTO_INCREMENT,
user_id				INT				NOT NULL, 
dept_id				INT,
visibility_scope	ENUM('Members', 'Dept Heads', 'Everyone')		NOT NULL, 
announce_title		VARCHAR(50)		NOT NULL, 
announce_body		TEXT			NOT NULL, 
announce_expiry		DATETIME		NOT NULL, 
allow_opt_out		BOOLEAN			NOT NULL, 
announce_delivery	TIMESTAMP		NOT NULL, 
archived			BOOLEAN			NOT NULL, 
created_at			TIMESTAMP		NOT NULL, 
updated_at			TIMESTAMP,
PRIMARY KEY (announcement_id),
INDEX user_id (user_id),
INDEX dept_id (dept_id),
FOREIGN KEY (user_id) REFERENCES User (user_id),
FOREIGN KEY (dept_id) REFERENCES Department (dept_id)
);

CREATE TABLE AuditLog (
log_id			INT					NOT NULL  						AUTO_INCREMENT,
user_id			INT					NOT NULL, 
action			ENUM('Create', 'Update', 'Delete', 'Archive')		NOT NULL, 
entity_type		VARCHAR(50)			NOT NULL, 
entity_id		INT					NOT NULL, 
before_json		JSON				NOT NULL, 
after_json		JSON				NOT NULL, 
occurred_at		TIMESTAMP			NOT NULL, 
PRIMARY KEY (log_id),
INDEX user_id (user_id),
INDEX entity_id (entity_id),
FOREIGN KEY (user_id) REFERENCES User (user_id)
);

CREATE TABLE Suggestion (
suggestion_id	INT					NOT NULL  						AUTO_INCREMENT,
full_name		VARCHAR(50)			NOT NULL, 
contact_email	VARCHAR(50)			NOT NULL, 
visitor_msg		TEXT				NOT NULL, 
msg_status		ENUM('Pending', 'Reviewed', 'Finalized')			NOT NULL, 
session_id		VARCHAR(50)			NOT NULL, 
created_at		TIMESTAMP			NOT NULL, 
PRIMARY KEY (suggestion_id)
);



// adding values to the database, personal info altered for privacy 

INSERT INTO User 
(
user_id,
first_name, 
last_name,		 
user_email,		 
user_phone, 
user_address, 
password_hash, 
is_active, 
joined_on, 
last_login 
)

VALUES

(1, 'Carie', 'Baig', 'carie_b0009@email.com', '(217) 555-0101', '101 Maple Grove Drive Springfield, IL 62704', 'a331e2c7bff38160c7d834a8ee01a3a307ea9541', 1, '2022-03-15 08:12:45', '2023-07-21 14:55:12'), 

(2, 'Aliyah', 'Salah', 'sal11390@email.com', '(608) 555-0102', '245 Oak Valley Road Madison, WI 53711', '588c7f7239f15fd0c45fdb08c0bacd47482965d1', 1, '2021-11-02 16:45:30', '2023-01-18 09:23:50'),

(3, 'Kamila', 'Nawaz', 'kamkam13506@email.com', '(919) 555-0103', '389 Pine Hill Lane Raleigh, NC 27607', 'e0b38d39df70f519eec195b5865249e29d208c4d', 1, '2020-06-10 12:05:10', '2022-12-22 18:40:05'),

(4, 'Samiya', 'Rizzi', 'srizzi@email.com', '(626) 555-0104', '512 Sunset Ridge Avenue
Pasadena, CA 91105', 'd44a646c242a7de4dfd318d92170f9250859f4bf', 1, '2023-01-22 10:20:00, 2023-12-15 11:05:45'), 

(5, 'Roxanne', 'Sumar', 'rsumar@email.com', '(802) 555-0105', '76 Riverstone Court
Burlington, VT 05401', '5fce5e4f146b95ac6417eadee8a74b75b2a3b386', 1, '2021-08-05 14:30:25', '2023-04-03 07:50:12'),

(6, 'Mina', 'Hashim', 'minahashim@email.com', '(972) 555-0106', '834 Willow Bend Way Plano, TX 75024', '7a0066282501c336828d003175bdb54661f57353', 1, '2022-02-28 09:12:15', '2023-08-09 21:15:35'),

(7, 'Mariam', 'Latif', 'latimari@email.com', '(425) 555-0107', '690 Cedar Ridge Drive Bellevue, WA 98008', '11e2574e9a33efb39ceb3f9d046030d05ea13940', 1, '2020-12-15 22:10:50', '2022-10-30 08:05:25'),

(8, 'Nadia', 'Maroon', 'mar00nn@email.com', '(614) 555-0108', '918 Meadowbrook Lane
Columbus, OH 43221', '058255ad1f0a570e8175783ad49429107c2c8c06', 1, '2021-05-19 07:45:40', '2023-03-12 19:35:50'), 

(9, 'Lula', 'Mirza', 'mirza_lu@email.com', '(847) 555-0109', '207 Lakeside Parkway
Evanston, IL 60202', '01c0ff841cb2055f53dd1a5f22bf6afd02048ed9', 1, '2023-02-10 13:15:30', '2023-12-01 16:40:20'),

(10, 'Inaya', 'Sheikh', 'sheikh2005@email.com', '(480) 555-0110', '561 Highland Park Drive
Scottsdale, AZ 85255', '06c72080d5e3115ab95c0ae3af325bafb8b460c0', 1, '2021-09-30 11:25:55', '2023-09-18 10:15:00'), 

(11, 'Jasmine', 'Taha', 'jazzy0267@email.com', '(919) 555-0111', '744 Brookhaven Road
Chapel Hill, NC 27516', '3a5577a3b1766e1ce8913473745a246cbc37d32a', 1, '2022-07-07 17:40:20', '2023-06-11 22:55:10'), 

(12, 'Malay', 'Usami', 'musami89@email.com', '(707) 555-0112', '1205 Redwood Springs Circle
Santa Rosa, CA 95404', '856f259020e565d14dceb7ca94ac130dc596e7ec', 1, '2020-03-22 06:55:10', '2022-11-08 13:10:25'), 

(13, 'Farah', 'Amin', 'faraha@email.com', '(828) 555-0113', '967 Autumn Crest Lane
Asheville, NC 28803', '64211502d6a9ecd3eb8b7c91e9886c8aadf67f1e', 1, '2021-12-25 19:05:45', '2023-08-05 17:30:15'),
 
(14, 'Sofie', 'Nasser', 'sofiebee23@email.com', '(609) 555-0114', '29 Stonegate Boulevard
Princeton, NJ 08540', 'e298c8e7d3b7a83af9aae2b189b00b1e13a64277', 1, '2021-01-18 15:30:40', '2023-05-25 12:45:35'), 

(15, 'Fatima', 'Noore', 'f_noore3342@email.com', '(410) 555-0115', '392 Harbor Point Drive
Annapolis, MD 21403', '920b9fb1dbf9c13240bf47f644d3b71d6353b065', 1, '2022-09-05 09:15:25', '2023-10-29 08:05:55'), 
 
(16, 'Amara', 'Noore', 'a_noore1207@email.com', '(410) 555-0116', '392 Harbor Point Drive
Annapolis, MD 21403', '5772fa800ad99dd0cc3c59cdabdacf8f1f906603', 1, '2022-09-05 09:40:00', '2022-09-20 14:30:45'),

(17, 'Zoha', 'K', 'kha27882@email.com', '(406) 555-0117', '155 Golden Meadow Drive
Bozeman, MT 59718', '55e25e785d2c1cd969086a905da929ce0cc8bf85', 1, '2023-03-12 12:55:30', '2023-12-03 20:25:50'),
     
(18, 'JJ', 'G', 'gil42134@email.com', '(941) 555-0118', '880 Cypress Hollow Road
Sarasota, FL 34232', 'b148bc09cb2817b5becbfd48af7d1db1ca696bb4', 1, '2021-06-28 18:20:15', '2023-07-15 09:05:40'),
    
(19, 'Kah', 'O', 'ong92990@email.com', '(970) 555-0119', '602 Juniper Ridge Lane
Fort Collins, CO 80525', '50a7097293554de80ba95b1aef309aab63e7f858', 1, '2022-04-09 10:10:50', '2023-09-22 15:50:25'),  
     
(20, 'Shan', 'K', 'kat44977@email.com', '(859) 555-0120', '2173 Bluebird Crossing
Lexington, KY 40503', 'd51d2230171c9c68db83deb9480f36c19f491268', 1, '2020-11-14 08:35:20', '2022-12-18 11:45:10');
   

INSERT INTO Role 
(
role_id,
role_name,
role_desc
)
VALUES
(1, 'President', 'placeholder text'),
(2, 'Department Head', 'placeholder text'),
(3, 'Member', 'placeholder text'),
(4, 'Admin/Maintenance'; 'placeholder text');


INSERT INTO UserRole 
(
user_id,
role_id	
)
VALUE
(1, 3),
(2, 3),
(3, 3),
(4, 3),
(5, 3),
(6, 3),
(7, 3),
(8, 3),
(9, 3),
(10, 3),
(11, 3),
(12, 3),
(13, 3),
(14, 3),
(15, 3),
(16, 3),
(17, 2),
(17, 3),
(17, 4),
(18, 4),
(19, 4),
(20, 4);


INSERT INTO Department 
(
dept_id,
user_id,
dept_name,
dept_desc
)
VALUES
(1, 17, 'Reporting Department', 'placeholder text');


INSERT INTO CalendarEvent 
(
event_id,
event_title,
event_desc,
event_location,
event_date,
recurring, 
iterations,
created_at
)
VALUES
(1, 'First Day of Class', 'The first day of Spring Term begins.', 'D2L', '2026-01-20 00:00:00', NULL, NULL, '2026-01-08 14:42:45'),   
(2, 'Team Meeting', 'Gather to discuss future developments.', 'Zoom', '2026-01-26 12:30:00', 'Weekly', 15, '2026-01-08 14:48:31'); 


INSERT INTO Permission 
(
permission_id,
perm_title, 
perm_desc, 
perm_resource, 
perm_crud
)
VALUES
(1, 'Oversee all member accounts', 'placeholder text', 'User', 'Read');


INSERT INTO RolePermission 
(
roleperm_id,
permission_id, 
role_id
)
VALUES
(1, 1, 1);


